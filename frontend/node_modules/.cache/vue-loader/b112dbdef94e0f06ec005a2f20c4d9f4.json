{"remainingRequest":"E:\\gatekeeper\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\gatekeeper\\frontend\\src\\components\\Layout.vue?vue&type=style&index=0&id=005bfc5a&scoped=true&lang=css","dependencies":[{"path":"E:\\gatekeeper\\frontend\\src\\components\\Layout.vue","mtime":1745292702895},{"path":"E:\\gatekeeper\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1740710846355},{"path":"E:\\gatekeeper\\frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1740710850033},{"path":"E:\\gatekeeper\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1740710847386},{"path":"E:\\gatekeeper\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1740710845061},{"path":"E:\\gatekeeper\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1740710848685}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5sYXlvdXQgewogIGhlaWdodDogMTAwdmg7CiAgYmFja2dyb3VuZC1jb2xvcjogI2YwZjJmNTsKfQoKLmVsLWFzaWRlIHsKICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCAjRjhGQUZGIDAlLCAjRjBGNUZGIDEwMCUpOwogIGhlaWdodDogMTAwdmg7CiAgYm94LXNoYWRvdzogMXB4IDAgOHB4IHJnYmEoMCwwLDAsMC4wNSk7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIHdpZHRoOiAxODBweCAhaW1wb3J0YW50Owp9CgouZWwtbWVudSB7CiAgYm9yZGVyLXJpZ2h0OiBub25lOwogIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OwogIHBhZGRpbmctdG9wOiAxMnB4OwogIGZsZXg6IDE7CiAgd2lkdGg6IDE4MHB4Owp9CgouZWwtbWVudS1pdGVtIHsKICBoZWlnaHQ6IDQ4cHg7CiAgbGluZS1oZWlnaHQ6IDQ4cHg7CiAgY29sb3I6ICM1QjZCOEIgIWltcG9ydGFudDsKICBtYXJnaW46IDRweCAxMnB4OwogIHBhZGRpbmc6IDAgMTZweCAhaW1wb3J0YW50OwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBmb250LXNpemU6IDE0cHg7CiAgdHJhbnNpdGlvbjogYWxsIDAuM3MgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKTsKfQoKLmVsLW1lbnUtaXRlbTpob3ZlciB7CiAgY29sb3I6ICM0QjdCRTUgIWltcG9ydGFudDsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDc1LCAxMjMsIDIyOSwgMC4wOCkgIWltcG9ydGFudDsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoNHB4KTsKfQoKLmVsLW1lbnUtaXRlbS5pcy1hY3RpdmUgewogIGNvbG9yOiAjNEI3QkU1ICFpbXBvcnRhbnQ7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSg3NSwgMTIzLCAyMjksIDAuMTIpICFpbXBvcnRhbnQ7CiAgZm9udC13ZWlnaHQ6IDUwMDsKfQoKLmVsLXN1Ym1lbnUgL2RlZXAvIC5lbC1zdWJtZW51X190aXRsZSB7CiAgaGVpZ2h0OiA0OHB4OwogIGxpbmUtaGVpZ2h0OiA0OHB4OwogIGNvbG9yOiAjNUI2QjhCICFpbXBvcnRhbnQ7CiAgbWFyZ2luOiA0cHggMTJweDsKICBwYWRkaW5nOiAwIDE2cHggIWltcG9ydGFudDsKICBib3JkZXItcmFkaXVzOiA4cHg7CiAgZm9udC1zaXplOiAxNHB4OwogIHRyYW5zaXRpb246IGFsbCAwLjNzIGN1YmljLWJlemllcigwLjQsIDAsIDAuMiwgMSk7Cn0KCi5lbC1zdWJtZW51IC9kZWVwLyAuZWwtc3VibWVudV9fdGl0bGU6aG92ZXIgewogIGNvbG9yOiAjNEI3QkU1ICFpbXBvcnRhbnQ7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSg3NSwgMTIzLCAyMjksIDAuMDgpICFpbXBvcnRhbnQ7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDRweCk7Cn0KCi5lbC1zdWJtZW51LmlzLWFjdGl2ZSAvZGVlcC8gLmVsLXN1Ym1lbnVfX3RpdGxlIHsKICBjb2xvcjogIzRCN0JFNSAhaW1wb3J0YW50Owp9CgouZWwtc3VibWVudSAvZGVlcC8gLmVsLW1lbnUgewogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50ICFpbXBvcnRhbnQ7CiAgcGFkZGluZy1sZWZ0OiA4cHg7CiAgbWFyZ2luOiAwIDhweDsKICBib3JkZXItcmFkaXVzOiA4cHg7Cn0KCi5lbC1tZW51LWl0ZW0gaSwgLmVsLXN1Ym1lbnUgL2RlZXAvIC5lbC1zdWJtZW51X190aXRsZSBpIHsKICBtYXJnaW4tcmlnaHQ6IDEycHg7CiAgd2lkdGg6IDE4cHg7CiAgZm9udC1zaXplOiAxOHB4OwogIGNvbG9yOiBpbmhlcml0OwogIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7Cn0KCi5oZWFkZXItY29udGVudCB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGhlaWdodDogMTAwJTsKICBwYWRkaW5nOiAwIDI0cHg7CiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjNUI4RkY5IDAlLCAjNEI3QkU1IDEwMCUpOwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjEpOwp9CgouaGVhZGVyLXRpdGxlIHsKICBjb2xvcjogI2ZmZjsKICBmb250LXNpemU6IDE4cHg7CiAgZm9udC13ZWlnaHQ6IDUwMDsKICBsZXR0ZXItc3BhY2luZzogMC41cHg7CiAgb3BhY2l0eTogMC45NTsKICBtYXJnaW4tbGVmdDogMjBweDsKfQoKLnVzZXItZHJvcGRvd24gewogIG1hcmdpbi1sZWZ0OiBhdXRvOwp9CgoudXNlci1pbmZvIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgcGFkZGluZzogNnB4IDE2cHg7CiAgY3Vyc29yOiBwb2ludGVyOwogIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKTsKICBib3JkZXItcmFkaXVzOiAyMHB4OwogIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7Cn0KCi51c2VyLWluZm86aG92ZXIgewogIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKTsKfQoKLnVzZXItaW5mbyBpIHsKICBjb2xvcjogI2ZmZjsKICBmb250LXNpemU6IDE2cHg7Cn0KCi51c2VyLWluZm8gewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBwYWRkaW5nOiA2cHggMTRweDsgLyog6LCD5pW0ICovCiAgY3Vyc29yOiBwb2ludGVyOwogIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKTsKICBib3JkZXItcmFkaXVzOiAyMHB4OwogIHRyYW5zaXRpb246IGFsbCAwLjJzIGN1YmljLWJlemllcigwLjQsIDAsIDAuMiwgMSk7IC8qIOiwg+aVtCAqLwogIGdhcDogNnB4OyAvKiDmlrDlop4gKi8KfQoKLmVsLWRyb3Bkb3duLW1lbnUgewogIG1pbi13aWR0aDogMTQwcHg7IC8qIOaWsOWiniAqLwogIGJvcmRlci1yYWRpdXM6IDZweDsgLyog6LCD5pW0ICovCiAgbWFyZ2luLXRvcDogNHB4OyAvKiDlh4/lsJHpl7Tot50gKi8KfQoKLmVsLWRyb3Bkb3duLW1lbnVfX2l0ZW0gewogIGFsaWduLWl0ZW1zOiBjZW50ZXI7IC8qIOaWsOWiniAqLwogIHBhZGRpbmc6IDhweCAxNnB4OyAvKiDosIPmlbQgKi8KICBmb250LXNpemU6IDEzcHg7IC8qIOWPr+mAie+8muiwg+Wwj+Wtl+WPtyAqLwp9CgouZWwtZHJvcGRvd24tbWVudV9faXRlbSBpIHsKICBtYXJnaW4tcmlnaHQ6IDhweDsgLyog6LCD5pW0ICovCiAgd2lkdGg6IDE4cHg7IC8qIOaWsOWiniAqLwogIGZvbnQtc2l6ZTogMTZweDsgLyog6LCD5pW0ICovCn0KCi5lbC1kcm9wZG93bi1tZW51X19pdGVtLmlzLWRpdmlkZWQgewogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZWJlZWY1OwogIG1hcmdpbjogNHB4IDA7CiAgcGFkZGluZy10b3A6IDhweDsgLyog6LCD5pW0ICovCn0KCi5lbC1oZWFkZXIgewogIHBhZGRpbmc6IDA7CiAgaGVpZ2h0OiA2MHB4ICFpbXBvcnRhbnQ7CiAgYm94LXNoYWRvdzogMCAxcHggNHB4IHJnYmEoMCwyMSw0MSwwLjA4KTsKICB6LWluZGV4OiAxMDsKICBwb3NpdGlvbjogcmVsYXRpdmU7Cn0KCi5lbC1tYWluIHsKICBwYWRkaW5nOiAyMHB4OwogIGJhY2tncm91bmQtY29sb3I6ICNGOEZBRkY7Cn0KCi5jbGllbnQtc3RhdHVzIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgbWFyZ2luLXJpZ2h0OiAyNHB4OwogIHBhZGRpbmc6IDZweCAxMnB4OwogIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4xKTsKICBib3JkZXItcmFkaXVzOiAyMHB4OwogIGJhY2tkcm9wLWZpbHRlcjogYmx1cig1cHgpOwogIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7Cn0KCi5jbGllbnQtc3RhdHVzOmhvdmVyIHsKICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LDAuMTUpOwp9CgouY2xpZW50LWljb24gewogIGZvbnQtc2l6ZTogMTZweDsKICBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwwLjg1KTsKICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlOwp9CgouY2xpZW50LWljb24uZWwtaWNvbi1zdWNjZXNzIHsKICBjb2xvcjogIzY3QzIzQTsKICB0ZXh0LXNoYWRvdzogMCAwIDhweCByZ2JhKDEwMywgMTk0LCA1OCwgMC4zKTsKfQoKLmNsaWVudC1pY29uLmVsLWljb24tZXJyb3IgewogIGNvbG9yOiAjRjU2QzZDOwogIHRleHQtc2hhZG93OiAwIDAgOHB4IHJnYmEoMjQ1LCAxMDgsIDEwOCwgMC4zKTsKfQoKLmNsaWVudC1pY29uLmVsLWljb24tbG9hZGluZyB7CiAgY29sb3I6ICM0MDlFRkY7CiAgdGV4dC1zaGFkb3c6IDAgMCA4cHggcmdiYSg2NCwgMTU4LCAyNTUsIDAuMyk7Cn0KCi8qIOWuouaIt+err+Wvueivneahhuagt+W8jyAqLwouY2xpZW50LWRpYWxvZy1jb250ZW50IHsKICBkaXNwbGF5OiBmbGV4OwogIHBhZGRpbmc6IDEwcHg7Cn0KCi5jbGllbnQtZGlhbG9nLWljb24gewogIG1hcmdpbi1yaWdodDogMTVweDsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0OwogIHBhZGRpbmctdG9wOiA1cHg7Cn0KCi5jbGllbnQtZGlhbG9nLWljb24gaSB7CiAgZm9udC1zaXplOiAyNHB4OwogIGNvbG9yOiAjRTZBMjNDOwogIGFuaW1hdGlvbjogcHVsc2UgMnMgaW5maW5pdGU7Cn0KCi5jbGllbnQtZGlhbG9nLW1lc3NhZ2UgewogIGZsZXg6IDE7Cn0KCi5jbGllbnQtZGlhbG9nLW1lc3NhZ2UgcCB7CiAgbWFyZ2luLXRvcDogMDsKICBtYXJnaW4tYm90dG9tOiAxMHB4OwogIGZvbnQtd2VpZ2h0OiA1MDA7CiAgY29sb3I6ICMzMDMxMzM7Cn0KCi5jbGllbnQtZGlhbG9nLW1lc3NhZ2Ugb2wgewogIG1hcmdpbjogMDsKICBwYWRkaW5nLWxlZnQ6IDIwcHg7CiAgY29sb3I6ICM2MDYyNjY7Cn0KCi5jbGllbnQtZGlhbG9nLW1lc3NhZ2UgbGkgewogIG1hcmdpbi1ib3R0b206IDhweDsKICBsaW5lLWhlaWdodDogMS41Owp9CgpAa2V5ZnJhbWVzIHB1bHNlIHsKICAwJSB7CiAgICBvcGFjaXR5OiAxOwogIH0KICA1MCUgewogICAgb3BhY2l0eTogMC42OwogIH0KICAxMDAlIHsKICAgIG9wYWNpdHk6IDE7CiAgfQp9CgovKiDlop7liqDlr7nor53moYbkuK3mjInpkq7nmoTpl7Tot50gKi8KLmRpYWxvZy1mb290ZXIgLmVsLWJ1dHRvbiB7CiAgbWFyZ2luLWxlZnQ6IDEwcHg7Cn0K"},{"version":3,"sources":["Layout.vue"],"names":[],"mappings":";AAqhBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Layout.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"layout\" @mousemove=\"resetInactivityTimer\" @click=\"checkAndResetTimer\" @keydown=\"resetInactivityTimer\">\n    <el-container>\n      <el-header height=\"50px\">\n        <div class=\"header-content\">\n          <div class=\"client-status\">\n            <el-tooltip :content=\"statusText\" placement=\"bottom\">\n              <i :class=\"['client-icon', statusIcon]\"></i>\n            </el-tooltip>\n          </div>\n          <span class=\"header-title\">堡垒机管理系统</span>\n          \n          <!-- 用户信息下拉菜单 -->\n          <div class=\"user-dropdown\">\n            <el-dropdown trigger=\"click\" @command=\"handleCommand\">\n              <div class=\"user-info\">\n                <i class=\"el-icon-user-solid\"></i>\n                <span>{{ currentUser.username }}</span>\n                <i class=\"el-icon-caret-bottom\"></i>\n              </div>\n              <el-dropdown-menu slot=\"dropdown\">\n                <el-dropdown-item command=\"changePassword\">\n                  <i class=\"el-icon-key\"></i>\n                  <span>修改密码</span>\n                </el-dropdown-item>\n                <el-dropdown-item divided command=\"logout\">\n                  <i class=\"el-icon-switch-button\"></i>\n                  <span>退出登录</span>\n                </el-dropdown-item>\n              </el-dropdown-menu>\n            </el-dropdown>\n          </div>\n        </div>\n      </el-header>\n      \n      <el-container>\n        <el-aside width=\"180px\">\n          <el-menu\n            :default-active=\"$route.path\"\n            class=\"el-menu-vertical\"\n            router>\n            <el-menu-item index=\"/\">\n              <i class=\"el-icon-monitor\"></i>\n              <span>服务器管理</span>\n            </el-menu-item>\n            \n            <el-submenu index=\"2\">\n              <template slot=\"title\">\n                <i class=\"el-icon-setting\"></i>\n                <span>系统设置</span>\n              </template>\n              <el-menu-item index=\"/users\">\n                <i class=\"el-icon-user\"></i>\n                <span>用户管理</span>\n              </el-menu-item>\n              <el-menu-item index=\"/system/categories\" v-if=\"isAdmin\">\n                <i class=\"el-icon-collection-tag\"></i>\n                <span>分类管理</span>\n              </el-menu-item>\n            </el-submenu>\n          </el-menu>\n        </el-aside>\n        \n        <el-main>\n          <router-view></router-view>\n        </el-main>\n      </el-container>\n    </el-container>\n\n    <!-- 修改密码对话框 -->\n    <el-dialog\n      title=\"修改密码\"\n      :visible.sync=\"passwordDialogVisible\"\n      width=\"400px\"\n      :close-on-click-modal=\"false\">\n      <el-form\n        :model=\"passwordForm\"\n        :rules=\"passwordRules\"\n        ref=\"passwordForm\"\n        label-width=\"100px\">\n        <el-form-item label=\"原密码\" prop=\"oldPassword\">\n          <el-input\n            v-model=\"passwordForm.oldPassword\"\n            type=\"password\"\n            show-password\n            placeholder=\"请输入原密码\">\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"新密码\" prop=\"newPassword\">\n          <el-input\n            v-model=\"passwordForm.newPassword\"\n            type=\"password\"\n            show-password\n            placeholder=\"请输入新密码\">\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"确认新密码\" prop=\"confirmPassword\">\n          <el-input\n            v-model=\"passwordForm.confirmPassword\"\n            type=\"password\"\n            show-password\n            placeholder=\"请再次输入新密码\">\n          </el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"passwordDialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitPasswordChange\">确 定</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\n\nexport default {\n  name: 'Layout',\n  data() {\n    // 密码确认验证函数\n    const validateConfirmPassword = (rule, value, callback) => {\n      if (value !== this.passwordForm.newPassword) {\n        callback(new Error('两次输入的密码不一致'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      clientConnected: false,\n      clientStatus: null,\n      checkingStatus: false,\n      showClientDialog: false,\n      passwordDialogVisible: false,\n      clientConfig: {\n        // 客户端协议，用于启动客户端应用\n        protocol: 'fort://',\n        // 客户端端口，用于检测客户端状态\n        port: 45654,\n        // 客户端下载文件名\n        fileName: 'GatekeeperSetup.exe'\n      },\n      passwordForm: {\n        oldPassword: '',\n        newPassword: '',\n        confirmPassword: ''\n      },\n      passwordRules: {\n        oldPassword: [\n          { required: true, message: '请输入原密码', trigger: 'blur' }\n        ],\n        newPassword: [\n          { required: true, message: '请输入新密码', trigger: 'blur' },\n          { min: 6, message: '密码长度不能小于6个字符', trigger: 'blur' }\n        ],\n        confirmPassword: [\n          { required: true, message: '请再次输入新密码', trigger: 'blur' },\n          { validator: validateConfirmPassword, trigger: 'blur' }\n        ]\n      },\n      statusCheckController: null,\n      lastCheckTime: 0, // 添加上次检查时间记录\n      consecutiveFailures: 0 // 添加连续失败次数记录\n    }\n  },\n  computed: {\n    statusIcon() {\n      if (this.checkingStatus) return 'el-icon-loading';\n      if (!this.clientStatus) return 'el-icon-error';\n      return this.clientStatus.server_connected ? 'el-icon-success' : 'el-icon-warning';\n    },\n    statusText() {\n      if (this.checkingStatus) return '正在检查客户端状态...';\n      if (!this.clientStatus) return '客户端未连接';\n      if (!this.clientStatus.server_connected) return '堡垒机连接断开';\n      return '客户端已连接';\n    },\n    isLoggedIn() {\n      return this.$store.state.user !== null;\n    },\n    isAdmin() {\n      return this.$store.state.user && this.$store.state.user.is_admin;\n    },\n    currentUser() {\n      return this.$store.state.user || { username: '' };\n    }\n  },\n  methods: {\n    // 重置不活动计时器\n    resetInactivityTimer() {\n      // 使用Vuex action重置计时器\n      this.$store.dispatch('resetInactivityTimer');\n    },\n    \n    // 检查客户端状态并重置计时器\n    checkAndResetTimer() {\n      this.resetInactivityTimer();\n      \n      // 如果最后一次检查是在3秒前，且当前未在检查中，则立即检查\n      const now = Date.now();\n      if (now - this.lastCheckTime > 3000 && !this.checkingStatus) {\n        this.checkClientStatus();\n      }\n    },\n    async handleLogout() {\n      try {\n        // 调用注销接口\n        await axios.post('/api/auth/logout');\n        // 清除本地存储的 token 和用户信息\n        localStorage.removeItem('token');\n        this.$store.commit('SET_USER', null);\n        // 停止状态检查\n        this.stopStatusCheck();\n        // 重置状态\n        this.clientConnected = false;\n        this.clientStatus = null;\n        this.checkingStatus = false;\n        this.showClientDialog = false;\n        // 跳转到登录页面\n        this.$router.push('/login');\n        this.$message.success('注销成功');\n      } catch (error) {\n        console.error('注销失败:', error);\n        const errorMessage = error.response && error.response.data && error.response.data.error || error.message;\n        this.$message.error('注销失败: ' + errorMessage);\n      }\n    },\n    async checkClientStatus() {\n      // 如果未登录，不执行检查\n      if (!this.isLoggedIn) {\n        return;\n      }\n      \n      // 检查是否处于冷却期（1秒内）且当前未在检查中\n      const now = Date.now();\n      if (now - this.lastCheckTime < 1000 && !this.checkingStatus) {\n        console.log('客户端状态检查过于频繁，忽略本次检查');\n        return;\n      }\n      \n      // 更新最后检查时间\n      this.lastCheckTime = now;\n      \n      // 记录检查前的连接状态\n      const wasConnected = this.clientConnected;\n      \n      try {\n        // 设置正在检查状态\n        this.checkingStatus = true;\n\n        // 取消之前的请求（如果有）\n        if (this.statusCheckController) {\n          this.statusCheckController.abort();\n        }\n        \n        // 创建新的 AbortController\n        this.statusCheckController = new AbortController();\n        const timeout = setTimeout(() => this.statusCheckController.abort(), 1500);\n        \n        // 直接从本地客户端获取状态\n        const response = await fetch('http://127.0.0.1:45654/status', {\n          method: 'GET',\n          headers: {\n            'Accept': 'application/json'\n          },\n          signal: this.statusCheckController.signal\n        });\n        \n        clearTimeout(timeout);\n        \n        if (response.ok) {\n          const data = await response.json();\n          this.clientStatus = data;\n          this.clientConnected = data.status === 'running' && data.server_connected;\n          \n          // 保存客户端信息到store\n          this.$store.commit('SET_CLIENT_INFO', data);\n          \n          // 如果连接成功，重置连续失败次数\n          if (this.clientConnected) {\n            this.consecutiveFailures = 0;\n            \n            // 如果之前未连接，现在连接成功，显示连接成功提示\n            if (!wasConnected) {\n              this.$notify({\n                title: '客户端已连接',\n                message: '堡垒机客户端连接成功',\n                type: 'success',\n                duration: 3000,\n                position: 'top-right'\n              });\n            }\n          } else {\n            // 即使请求成功，但如果客户端未真正连接，也计为失败\n            this.consecutiveFailures++;\n          }\n          \n          console.log('客户端状态:', data);\n        } else {\n          this.clientStatus = null;\n          this.clientConnected = false;\n          this.$store.commit('SET_CLIENT_INFO', null);\n          \n          // 增加连续失败次数\n          this.consecutiveFailures++;\n        }\n      } catch (error) {\n        this.clientStatus = null;\n        this.clientConnected = false;\n        this.$store.commit('SET_CLIENT_INFO', null);\n        \n        // 对任何错误（包括AbortError）都增加连续失败次数，但权重不同\n        if (error.name === 'AbortError') {\n          // 超时错误也算作失败，但增加幅度较小\n          this.consecutiveFailures += 0.5;\n          console.log('检查客户端状态超时');\n        } else {\n          this.consecutiveFailures++;\n          console.error('检查客户端状态失败:', error);\n        }\n      } finally {\n        this.checkingStatus = false;\n        this.statusCheckController = null;\n      }\n    },\n    \n    // 在下面的方法中，增加立即检查状态的逻辑\n    downloadClient() {\n      try {\n        // 使用静态的下载链接\n        const downloadUrl = '/static/GatekeeperSetup.exe';\n        \n        // 关闭对话框并显示提示\n        this.showClientDialog = false;\n        this.$message.success('开始下载客户端，请稍候...');\n        \n        // 采用多种方法尝试下载，增加成功率\n        \n        // 方法1：创建一个隐藏的a标签并触发点击下载\n        const link = document.createElement('a');\n        link.href = downloadUrl;\n        link.setAttribute('download', 'GatekeeperSetup.exe');\n        link.setAttribute('target', '_blank');\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        \n        // 方法3：使用iframe下载\n        const iframe = document.createElement('iframe');\n        iframe.style.display = 'none';\n        iframe.src = downloadUrl;\n        document.body.appendChild(iframe);\n        // 2秒后移除iframe\n        setTimeout(() => {\n          document.body.removeChild(iframe);\n        }, 2000);\n        \n        // 方法2：延迟确认下载是否开始\n        setTimeout(() => {\n          this.$confirm('如果下载没有自动开始，请点击\"确定\"重新下载', '下载提示', {\n            confirmButtonText: '重新下载',\n            cancelButtonText: '已在下载',\n            type: 'info'\n          }).then(() => {\n            // 用户点击了重新下载\n            this.axiosDownload(downloadUrl);\n          }).catch(() => {\n            // 用户点击了已在下载，不做处理\n          });\n        }, 3000);\n        \n        // 下载后标记为已安装\n        setTimeout(() => {\n          this.clientInstalled = true;\n          localStorage.setItem('clientInstalled', 'true');\n        }, 3000);\n      } catch (error) {\n        console.error('下载客户端出错:', error);\n        this.$message.error('下载失败，请稍后再试或联系管理员');\n      }\n    },\n    \n    // 新增：使用axios下载文件的方法\n    axiosDownload(url) {\n      axios({\n        url: url,\n        method: 'GET',\n        responseType: 'blob', // 重要，指定响应类型为blob\n      }).then(response => {\n        const blob = new Blob([response.data]);\n        const link = document.createElement('a');\n        link.href = URL.createObjectURL(blob);\n        link.download = 'GatekeeperSetup.exe';\n        link.click();\n        URL.revokeObjectURL(link.href);\n        this.$message.success('已重新触发下载，请查看浏览器下载状态');\n      }).catch(error => {\n        console.error('axios下载失败:', error);\n        this.$message.error('下载失败，请联系管理员');\n      });\n    },\n    \n    startClient() {\n      // 如果客户端已经连接，则不需要启动\n      if (this.clientConnected) {\n        this.$message.info('客户端已连接，无需重新启动');\n        this.showClientDialog = false;\n        return;\n      }\n      \n      // 显示正在尝试连接的消息\n      this.$message({\n        message: '正在尝试启动客户端...',\n        type: 'info',\n        duration: 3000\n      });\n      \n      // 关闭对话框\n      this.showClientDialog = false;\n      \n      // 使用注册的协议启动客户端\n      window.location.href = 'fort://start';\n      \n      // 设置一个短暂的延迟后再次检查客户端状态\n      setTimeout(() => {\n        console.log('启动客户端后重新检查状态');\n        this.checkClientStatus();\n      }, 3000);\n    },\n    \n    checkClientInstalled() {\n      this.clientInstalled = true;\n    },\n    \n    startStatusCheck() {\n      // 如果未登录，不启动检查\n      if (!this.isLoggedIn) {\n        return;\n      }\n      \n      // 如果已经有定时器在运行，先清除它\n      this.stopStatusCheck();\n      \n      // 更频繁地检查状态（每3秒一次）\n      this.statusCheckInterval = setInterval(() => {\n        this.checkClientStatus();\n      }, 3000); // 将检查间隔从5秒减少到3秒\n      \n      // 立即执行一次检查\n      this.checkClientStatus();\n    },\n    stopStatusCheck() {\n      if (this.statusCheckInterval) {\n        clearInterval(this.statusCheckInterval);\n        this.statusCheckInterval = null;\n      }\n      \n      // 取消进行中的请求\n      if (this.statusCheckController) {\n        this.statusCheckController.abort();\n        this.statusCheckController = null;\n      }\n    },\n    handleCommand(command) {\n      switch (command) {\n        case 'changePassword':\n          this.showChangePasswordDialog();\n          break;\n        case 'logout':\n          this.handleLogout();\n          break;\n      }\n    },\n    showChangePasswordDialog() {\n      this.passwordDialogVisible = true;\n      this.passwordForm = {\n        oldPassword: '',\n        newPassword: '',\n        confirmPassword: ''\n      };\n    },\n    async submitPasswordChange() {\n      try {\n        await this.$refs.passwordForm.validate();\n        \n        const response = await this.axios.post('/api/auth/change-password', {\n          old_password: this.passwordForm.oldPassword,\n          new_password: this.passwordForm.newPassword\n        });\n\n        if (response.data.success) {\n          this.$message.success('密码修改成功');\n          this.passwordDialogVisible = false;\n        }\n      } catch (error) {\n        if (error.response) {\n          this.$message.error(error.response.data.error || '密码修改失败');\n        } else if (error.message) {\n          // 表单验证错误\n          this.$message.error(error.message);\n        } else {\n          this.$message.error('密码修改失败');\n        }\n      }\n    }\n  },\n  watch: {\n    // 监听登录状态变化\n    isLoggedIn(newValue) {\n      if (newValue) {\n        this.startStatusCheck();\n        // 初始化不活动计时器\n        this.resetInactivityTimer();\n      } else {\n        this.stopStatusCheck();\n      }\n    }\n  },\n  mounted() {\n    // 只在登录状态下启动检查\n    if (this.isLoggedIn) {\n      this.startStatusCheck();\n      // 初始化不活动计时器\n      this.resetInactivityTimer();\n    }\n  },\n  beforeDestroy() {\n    this.stopStatusCheck();\n  }\n}\n</script>\n\n<style scoped>\n.layout {\n  height: 100vh;\n  background-color: #f0f2f5;\n}\n\n.el-aside {\n  background: linear-gradient(180deg, #F8FAFF 0%, #F0F5FF 100%);\n  height: 100vh;\n  box-shadow: 1px 0 8px rgba(0,0,0,0.05);\n  display: flex;\n  flex-direction: column;\n  width: 180px !important;\n}\n\n.el-menu {\n  border-right: none;\n  background: transparent;\n  padding-top: 12px;\n  flex: 1;\n  width: 180px;\n}\n\n.el-menu-item {\n  height: 48px;\n  line-height: 48px;\n  color: #5B6B8B !important;\n  margin: 4px 12px;\n  padding: 0 16px !important;\n  border-radius: 8px;\n  font-size: 14px;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.el-menu-item:hover {\n  color: #4B7BE5 !important;\n  background-color: rgba(75, 123, 229, 0.08) !important;\n  transform: translateX(4px);\n}\n\n.el-menu-item.is-active {\n  color: #4B7BE5 !important;\n  background-color: rgba(75, 123, 229, 0.12) !important;\n  font-weight: 500;\n}\n\n.el-submenu /deep/ .el-submenu__title {\n  height: 48px;\n  line-height: 48px;\n  color: #5B6B8B !important;\n  margin: 4px 12px;\n  padding: 0 16px !important;\n  border-radius: 8px;\n  font-size: 14px;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.el-submenu /deep/ .el-submenu__title:hover {\n  color: #4B7BE5 !important;\n  background-color: rgba(75, 123, 229, 0.08) !important;\n  transform: translateX(4px);\n}\n\n.el-submenu.is-active /deep/ .el-submenu__title {\n  color: #4B7BE5 !important;\n}\n\n.el-submenu /deep/ .el-menu {\n  background-color: transparent !important;\n  padding-left: 8px;\n  margin: 0 8px;\n  border-radius: 8px;\n}\n\n.el-menu-item i, .el-submenu /deep/ .el-submenu__title i {\n  margin-right: 12px;\n  width: 18px;\n  font-size: 18px;\n  color: inherit;\n  transition: all 0.3s ease;\n}\n\n.header-content {\n  display: flex;\n  align-items: center;\n  height: 100%;\n  padding: 0 24px;\n  background: linear-gradient(90deg, #5B8FF9 0%, #4B7BE5 100%);\n  position: relative;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\n.header-title {\n  color: #fff;\n  font-size: 18px;\n  font-weight: 500;\n  letter-spacing: 0.5px;\n  opacity: 0.95;\n  margin-left: 20px;\n}\n\n.user-dropdown {\n  margin-left: auto;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  padding: 6px 16px;\n  cursor: pointer;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 20px;\n  transition: all 0.3s ease;\n}\n\n.user-info:hover {\n  background: rgba(255, 255, 255, 0.2);\n}\n\n.user-info i {\n  color: #fff;\n  font-size: 16px;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  padding: 6px 14px; /* 调整 */\n  cursor: pointer;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 20px;\n  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); /* 调整 */\n  gap: 6px; /* 新增 */\n}\n\n.el-dropdown-menu {\n  min-width: 140px; /* 新增 */\n  border-radius: 6px; /* 调整 */\n  margin-top: 4px; /* 减少间距 */\n}\n\n.el-dropdown-menu__item {\n  align-items: center; /* 新增 */\n  padding: 8px 16px; /* 调整 */\n  font-size: 13px; /* 可选：调小字号 */\n}\n\n.el-dropdown-menu__item i {\n  margin-right: 8px; /* 调整 */\n  width: 18px; /* 新增 */\n  font-size: 16px; /* 调整 */\n}\n\n.el-dropdown-menu__item.is-divided {\n  border-top: 1px solid #ebeef5;\n  margin: 4px 0;\n  padding-top: 8px; /* 调整 */\n}\n\n.el-header {\n  padding: 0;\n  height: 60px !important;\n  box-shadow: 0 1px 4px rgba(0,21,41,0.08);\n  z-index: 10;\n  position: relative;\n}\n\n.el-main {\n  padding: 20px;\n  background-color: #F8FAFF;\n}\n\n.client-status {\n  display: flex;\n  align-items: center;\n  margin-right: 24px;\n  padding: 6px 12px;\n  background: rgba(255,255,255,0.1);\n  border-radius: 20px;\n  backdrop-filter: blur(5px);\n  transition: all 0.3s ease;\n}\n\n.client-status:hover {\n  background: rgba(255,255,255,0.15);\n}\n\n.client-icon {\n  font-size: 16px;\n  color: rgba(255,255,255,0.85);\n  transition: all 0.3s ease;\n}\n\n.client-icon.el-icon-success {\n  color: #67C23A;\n  text-shadow: 0 0 8px rgba(103, 194, 58, 0.3);\n}\n\n.client-icon.el-icon-error {\n  color: #F56C6C;\n  text-shadow: 0 0 8px rgba(245, 108, 108, 0.3);\n}\n\n.client-icon.el-icon-loading {\n  color: #409EFF;\n  text-shadow: 0 0 8px rgba(64, 158, 255, 0.3);\n}\n\n/* 客户端对话框样式 */\n.client-dialog-content {\n  display: flex;\n  padding: 10px;\n}\n\n.client-dialog-icon {\n  margin-right: 15px;\n  display: flex;\n  align-items: flex-start;\n  padding-top: 5px;\n}\n\n.client-dialog-icon i {\n  font-size: 24px;\n  color: #E6A23C;\n  animation: pulse 2s infinite;\n}\n\n.client-dialog-message {\n  flex: 1;\n}\n\n.client-dialog-message p {\n  margin-top: 0;\n  margin-bottom: 10px;\n  font-weight: 500;\n  color: #303133;\n}\n\n.client-dialog-message ol {\n  margin: 0;\n  padding-left: 20px;\n  color: #606266;\n}\n\n.client-dialog-message li {\n  margin-bottom: 8px;\n  line-height: 1.5;\n}\n\n@keyframes pulse {\n  0% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.6;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n/* 增加对话框中按钮的间距 */\n.dialog-footer .el-button {\n  margin-left: 10px;\n}\n</style>"]}]}