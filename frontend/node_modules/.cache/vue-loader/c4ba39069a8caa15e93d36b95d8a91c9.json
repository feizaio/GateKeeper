{"remainingRequest":"E:\\gatekeeper\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\gatekeeper\\frontend\\src\\components\\Layout.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\gatekeeper\\frontend\\src\\components\\Layout.vue","mtime":1745299605644},{"path":"E:\\gatekeeper\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1740710845061},{"path":"E:\\gatekeeper\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1740710847398},{"path":"E:\\gatekeeper\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1740710845061},{"path":"E:\\gatekeeper\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1740710848685}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBTaWRlYmFyIGZyb20gJy4vU2lkZWJhci52dWUnCmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCcKaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gJ2VsZW1lbnQtdWknCmltcG9ydCBheGlvcyBmcm9tICdheGlvcycKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7IFNpZGViYXIgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcGFzc3dvcmREaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgcGFzc3dvcmRGb3JtOiB7CiAgICAgICAgb2xkUGFzc3dvcmQ6ICcnLAogICAgICAgIG5ld1Bhc3N3b3JkOiAnJwogICAgICB9LAogICAgICBsYXN0QWN0aXZpdHlUaW1lOiBEYXRlLm5vdygpLAogICAgICBsYXN0Q2hlY2tUaW1lOiAwLAogICAgICBjaGVja2luZ1N0YXR1czogZmFsc2UKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBTdGF0ZShbJ3VzZXInXSkKICB9LAogIG1ldGhvZHM6IHsKICAgIGhhbmRsZUNvbW1hbmQoY29tbWFuZCkgewogICAgICBzd2l0Y2ggKGNvbW1hbmQpIHsKICAgICAgICBjYXNlICdsb2dvdXQnOgogICAgICAgICAgdGhpcy5oYW5kbGVMb2dvdXQoKQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdjaGFuZ2VQYXNzd29yZCc6CiAgICAgICAgICB0aGlzLnBhc3N3b3JkRGlhbG9nVmlzaWJsZSA9IHRydWUKICAgICAgICAgIGJyZWFrCiAgICAgIH0KICAgICAgdGhpcy5jaGVja0NsaWVudFN0YXR1c0lmTmVlZGVkKCkKICAgIH0sCiAgICBoYW5kbGVMb2dvdXQoKSB7CiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdsb2dvdXQnKS50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL2xvZ2luJykKICAgICAgfSkKICAgIH0sCiAgICBzdWJtaXRQYXNzd29yZENoYW5nZSgpIHsKICAgICAgYXhpb3MucG9zdCgnL2FwaS9jaGFuZ2UtcGFzc3dvcmQnLCB0aGlzLnBhc3N3b3JkRm9ybSkudGhlbigoKSA9PiB7CiAgICAgICAgTWVzc2FnZS5zdWNjZXNzKCflr4bnoIHkv67mlLnmiJDlip8nKQogICAgICAgIHRoaXMucGFzc3dvcmREaWFsb2dWaXNpYmxlID0gZmFsc2UKICAgICAgICB0aGlzLmNoZWNrQ2xpZW50U3RhdHVzSWZOZWVkZWQoKQogICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgTWVzc2FnZS5lcnJvcign5a+G56CB5L+u5pS55aSx6LSlJykKICAgICAgfSkKICAgIH0sCiAgICBjaGVja0FuZFJlc2V0VGltZXIoKSB7CiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCkKICAgICAgdGhpcy5sYXN0QWN0aXZpdHlUaW1lID0gbm93CiAgICAgIHRoaXMuY2hlY2tDbGllbnRTdGF0dXNJZk5lZWRlZCgpCiAgICB9LAogICAgY2hlY2tDbGllbnRTdGF0dXNJZk5lZWRlZCgpIHsKICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKQogICAgICBpZiAobm93IC0gdGhpcy5sYXN0Q2hlY2tUaW1lID4gMzAwMCAmJiAhdGhpcy5jaGVja2luZ1N0YXR1cykgewogICAgICAgIHRoaXMuY2hlY2tDbGllbnRTdGF0dXMoKQogICAgICB9CiAgICB9LAogICAgY2hlY2tDbGllbnRTdGF0dXMoKSB7CiAgICAgIHRoaXMuY2hlY2tpbmdTdGF0dXMgPSB0cnVlCiAgICAgIHRoaXMubGFzdENoZWNrVGltZSA9IERhdGUubm93KCkKICAgICAgYXhpb3MuZ2V0KCcvYXBpL2NsaWVudC1zdGF0dXMnKQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIGlmICghcmVzcG9uc2UuZGF0YS52YWxpZCkgewogICAgICAgICAgICBNZXNzYWdlLmVycm9yKCflrqLmiLfnq6/nirbmgIHlvILluLjvvIzor7fph43mlrDnmbvlvZUnKQogICAgICAgICAgICB0aGlzLmhhbmRsZUxvZ291dCgpCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgTWVzc2FnZS5lcnJvcign54q25oCB5qOA5rWL5aSx6LSl77yM6K+35qOA5p+l572R57ucJykKICAgICAgICB9KQogICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAgICAgICAgIHRoaXMuY2hlY2tpbmdTdGF0dXMgPSBmYWxzZQogICAgICAgIH0pCiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5jaGVja0NsaWVudFN0YXR1cygpCiAgfQp9Cg=="},{"version":3,"sources":["Layout.vue"],"names":[],"mappings":";AAkHA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Layout.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"layout\" @mousemove=\"resetInactivityTimer\" @click=\"checkAndResetTimer\" @keydown=\"resetInactivityTimer\">\n    <el-container>\n      <el-header height=\"50px\">\n        <div class=\"header-content\">\n          <div class=\"client-status\">\n            <el-tooltip :content=\"statusText\" placement=\"bottom\">\n              <i :class=\"['client-icon', statusIcon]\"></i>\n            </el-tooltip>\n          </div>\n          <span class=\"header-title\">堡垒机管理系统</span>\n          \n          <!-- 用户信息下拉菜单 -->\n          <div class=\"user-dropdown\">\n            <el-dropdown trigger=\"click\" @command=\"handleCommand\">\n              <div class=\"user-info\">\n                <i class=\"el-icon-user-solid\"></i>\n                <span>{{ currentUser.username }}</span>\n                <i class=\"el-icon-caret-bottom\"></i>\n              </div>\n              <el-dropdown-menu slot=\"dropdown\">\n                <el-dropdown-item command=\"changePassword\">\n                  <i class=\"el-icon-key\"></i>\n                  <span>修改密码</span>\n                </el-dropdown-item>\n                <el-dropdown-item divided command=\"logout\">\n                  <i class=\"el-icon-switch-button\"></i>\n                  <span>退出登录</span>\n                </el-dropdown-item>\n              </el-dropdown-menu>\n            </el-dropdown>\n          </div>\n        </div>\n      </el-header>\n      \n      <el-container>\n        <el-aside width=\"180px\">\n          <el-menu\n            :default-active=\"$route.path\"\n            class=\"el-menu-vertical\"\n            router>\n            <el-menu-item index=\"/\">\n              <i class=\"el-icon-monitor\"></i>\n              <span>服务器管理</span>\n            </el-menu-item>\n            \n            <el-submenu index=\"2\">\n              <template slot=\"title\">\n                <i class=\"el-icon-setting\"></i>\n                <span>系统设置</span>\n              </template>\n              <el-menu-item index=\"/users\">\n                <i class=\"el-icon-user\"></i>\n                <span>用户管理</span>\n              </el-menu-item>\n              <el-menu-item index=\"/system/categories\" v-if=\"isAdmin\">\n                <i class=\"el-icon-collection-tag\"></i>\n                <span>分类管理</span>\n              </el-menu-item>\n            </el-submenu>\n          </el-menu>\n        </el-aside>\n        \n        <el-main>\n          <router-view></router-view>\n        </el-main>\n      </el-container>\n    </el-container>\n\n    <!-- 修改密码对话框 -->\n    <el-dialog\n      title=\"修改密码\"\n      :visible.sync=\"passwordDialogVisible\"\n      width=\"400px\"\n      :close-on-click-modal=\"false\">\n      <el-form\n        :model=\"passwordForm\"\n        :rules=\"passwordRules\"\n        ref=\"passwordForm\"\n        label-width=\"100px\">\n        <el-form-item label=\"原密码\" prop=\"oldPassword\">\n          <el-input\n            v-model=\"passwordForm.oldPassword\"\n            type=\"password\"\n            show-password\n            placeholder=\"请输入原密码\">\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"新密码\" prop=\"newPassword\">\n          <el-input\n            v-model=\"passwordForm.newPassword\"\n            type=\"password\"\n            show-password\n            placeholder=\"请输入新密码\">\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"确认新密码\" prop=\"confirmPassword\">\n          <el-input\n            v-model=\"passwordForm.confirmPassword\"\n            type=\"password\"\n            show-password\n            placeholder=\"请再次输入新密码\">\n          </el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"passwordDialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitPasswordChange\">确 定</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport Sidebar from './Sidebar.vue'\nimport { mapState } from 'vuex'\nimport { Message } from 'element-ui'\nimport axios from 'axios'\n\nexport default {\n  components: { Sidebar },\n  data() {\n    return {\n      passwordDialogVisible: false,\n      passwordForm: {\n        oldPassword: '',\n        newPassword: ''\n      },\n      lastActivityTime: Date.now(),\n      lastCheckTime: 0,\n      checkingStatus: false\n    }\n  },\n  computed: {\n    ...mapState(['user'])\n  },\n  methods: {\n    handleCommand(command) {\n      switch (command) {\n        case 'logout':\n          this.handleLogout()\n          break\n        case 'changePassword':\n          this.passwordDialogVisible = true\n          break\n      }\n      this.checkClientStatusIfNeeded()\n    },\n    handleLogout() {\n      this.$store.dispatch('logout').then(() => {\n        this.$router.push('/login')\n      })\n    },\n    submitPasswordChange() {\n      axios.post('/api/change-password', this.passwordForm).then(() => {\n        Message.success('密码修改成功')\n        this.passwordDialogVisible = false\n        this.checkClientStatusIfNeeded()\n      }).catch(() => {\n        Message.error('密码修改失败')\n      })\n    },\n    checkAndResetTimer() {\n      const now = Date.now()\n      this.lastActivityTime = now\n      this.checkClientStatusIfNeeded()\n    },\n    checkClientStatusIfNeeded() {\n      const now = Date.now()\n      if (now - this.lastCheckTime > 3000 && !this.checkingStatus) {\n        this.checkClientStatus()\n      }\n    },\n    checkClientStatus() {\n      this.checkingStatus = true\n      this.lastCheckTime = Date.now()\n      axios.get('/api/client-status')\n        .then(response => {\n          if (!response.data.valid) {\n            Message.error('客户端状态异常，请重新登录')\n            this.handleLogout()\n          }\n        })\n        .catch(() => {\n          Message.error('状态检测失败，请检查网络')\n        })\n        .finally(() => {\n          this.checkingStatus = false\n        })\n    }\n  },\n  mounted() {\n    this.checkClientStatus()\n  }\n}\n</script>\n\n<style scoped>\n.layout {\n  height: 100vh;\n  background-color: #f0f2f5;\n}\n\n.el-aside {\n  background: linear-gradient(180deg, #F8FAFF 0%, #F0F5FF 100%);\n  height: 100vh;\n  box-shadow: 1px 0 8px rgba(0,0,0,0.05);\n  display: flex;\n  flex-direction: column;\n  width: 180px !important;\n}\n\n.el-menu {\n  border-right: none;\n  background: transparent;\n  padding-top: 12px;\n  flex: 1;\n  width: 180px;\n}\n\n.el-menu-item {\n  height: 48px;\n  line-height: 48px;\n  color: #5B6B8B !important;\n  margin: 4px 12px;\n  padding: 0 16px !important;\n  border-radius: 8px;\n  font-size: 14px;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.el-menu-item:hover {\n  color: #4B7BE5 !important;\n  background-color: rgba(75, 123, 229, 0.08) !important;\n  transform: translateX(4px);\n}\n\n.el-menu-item.is-active {\n  color: #4B7BE5 !important;\n  background-color: rgba(75, 123, 229, 0.12) !important;\n  font-weight: 500;\n}\n\n.el-submenu /deep/ .el-submenu__title {\n  height: 48px;\n  line-height: 48px;\n  color: #5B6B8B !important;\n  margin: 4px 12px;\n  padding: 0 16px !important;\n  border-radius: 8px;\n  font-size: 14px;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.el-submenu /deep/ .el-submenu__title:hover {\n  color: #4B7BE5 !important;\n  background-color: rgba(75, 123, 229, 0.08) !important;\n  transform: translateX(4px);\n}\n\n.el-submenu.is-active /deep/ .el-submenu__title {\n  color: #4B7BE5 !important;\n}\n\n.el-submenu /deep/ .el-menu {\n  background-color: transparent !important;\n  padding-left: 8px;\n  margin: 0 8px;\n  border-radius: 8px;\n}\n\n.el-menu-item i, .el-submenu /deep/ .el-submenu__title i {\n  margin-right: 12px;\n  width: 18px;\n  font-size: 18px;\n  color: inherit;\n  transition: all 0.3s ease;\n}\n\n.header-content {\n  display: flex;\n  align-items: center;\n  height: 100%;\n  padding: 0 24px;\n  background: linear-gradient(90deg, #5B8FF9 0%, #4B7BE5 100%);\n  position: relative;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\n.header-title {\n  color: #fff;\n  font-size: 18px;\n  font-weight: 500;\n  letter-spacing: 0.5px;\n  opacity: 0.95;\n  margin-left: 20px;\n}\n\n.user-dropdown {\n  margin-left: auto;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  padding: 6px 16px;\n  cursor: pointer;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 20px;\n  transition: all 0.3s ease;\n}\n\n.user-info:hover {\n  background: rgba(255, 255, 255, 0.2);\n}\n\n.user-info i {\n  color: #fff;\n  font-size: 16px;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  padding: 6px 14px; /* 调整 */\n  cursor: pointer;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 20px;\n  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); /* 调整 */\n  gap: 6px; /* 新增 */\n}\n\n.el-dropdown-menu {\n  min-width: 140px; /* 新增 */\n  border-radius: 6px; /* 调整 */\n  margin-top: 4px; /* 减少间距 */\n}\n\n.el-dropdown-menu__item {\n  align-items: center; /* 新增 */\n  padding: 8px 16px; /* 调整 */\n  font-size: 13px; /* 可选：调小字号 */\n}\n\n.el-dropdown-menu__item i {\n  margin-right: 8px; /* 调整 */\n  width: 18px; /* 新增 */\n  font-size: 16px; /* 调整 */\n}\n\n.el-dropdown-menu__item.is-divided {\n  border-top: 1px solid #ebeef5;\n  margin: 4px 0;\n  padding-top: 8px; /* 调整 */\n}\n\n.el-header {\n  padding: 0;\n  height: 60px !important;\n  box-shadow: 0 1px 4px rgba(0,21,41,0.08);\n  z-index: 10;\n  position: relative;\n}\n\n.el-main {\n  padding: 20px;\n  background-color: #F8FAFF;\n}\n\n.client-status {\n  display: flex;\n  align-items: center;\n  margin-right: 24px;\n  padding: 6px 12px;\n  background: rgba(255,255,255,0.1);\n  border-radius: 20px;\n  backdrop-filter: blur(5px);\n  transition: all 0.3s ease;\n}\n\n.client-status:hover {\n  background: rgba(255,255,255,0.15);\n}\n\n.client-icon {\n  font-size: 16px;\n  color: rgba(255,255,255,0.85);\n  transition: all 0.3s ease;\n}\n\n.client-icon.el-icon-success {\n  color: #67C23A;\n  text-shadow: 0 0 8px rgba(103, 194, 58, 0.3);\n}\n\n.client-icon.el-icon-error {\n  color: #F56C6C;\n  text-shadow: 0 0 8px rgba(245, 108, 108, 0.3);\n}\n\n.client-icon.el-icon-loading {\n  color: #409EFF;\n  text-shadow: 0 0 8px rgba(64, 158, 255, 0.3);\n}\n\n/* 客户端对话框样式 */\n.client-dialog-content {\n  display: flex;\n  padding: 10px;\n}\n\n.client-dialog-icon {\n  margin-right: 15px;\n  display: flex;\n  align-items: flex-start;\n  padding-top: 5px;\n}\n\n.client-dialog-icon i {\n  font-size: 24px;\n  color: #E6A23C;\n  animation: pulse 2s infinite;\n}\n\n.client-dialog-message {\n  flex: 1;\n}\n\n.client-dialog-message p {\n  margin-top: 0;\n  margin-bottom: 10px;\n  font-weight: 500;\n  color: #303133;\n}\n\n.client-dialog-message ol {\n  margin: 0;\n  padding-left: 20px;\n  color: #606266;\n}\n\n.client-dialog-message li {\n  margin-bottom: 8px;\n  line-height: 1.5;\n}\n\n@keyframes pulse {\n  0% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.6;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n/* 增加对话框中按钮的间距 */\n.dialog-footer .el-button {\n  margin-left: 10px;\n}\n</style>"]}]}